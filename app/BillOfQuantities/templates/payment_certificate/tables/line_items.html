{% if grouped_line_items %}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            {% define "9" as colSpan %}
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item No.</th>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price/Unit</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Previous Quantity</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Current Quantity</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Quantity</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Previous Claim</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Current Claim</th>
                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Claimed</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for structure_group in grouped_line_items %}
                    <tr>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 header font-bold"
                            colspan="{{ colSpan }}">{{ structure_group.structure.name }}</td>
                    </tr>
                    {% for bill_group in structure_group.bills %}
                        <tr>
                            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 header font-bold"
                                colspan="{{ colSpan }}">{{ bill_group.bill.name }}</td>
                        </tr>
                        {% for package_group in bill_group.packages %}
                            {% for line_item in package_group.line_items %}
                                <tr class="hover:bg-gray-50">
                                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.item_number|default:"-" }}</td>
                                    <td class="px-3 py-2 text-sm text-gray-900">{{ line_item.description|truncatewords:10 }}</td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">
                                        R {{ line_item.unit_price|floatformat:2|intcomma }} / {{ line_item.unit_measurement }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right">
                                        {{ line_item.previous_qty|floatformat:2|intcomma }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm font-semibold text-indigo-600 text-right">
                                        {{ line_item.current_qty|floatformat:2|intcomma }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm font-semibold text-gray-900 text-right">
                                        R {{ line_item.total_qty|floatformat:2|intcomma }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right">
                                        {{ line_item.previous_claimed|floatformat:2|intcomma }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm font-semibold text-indigo-600 text-right">
                                        {{ line_item.current_claim|floatformat:2|intcomma }}
                                    </td>
                                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right">
                                        R {{ line_item.total_claimed|floatformat:2|intcomma }}
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                {% endfor %}
            </tbody>
            <tfoot class="bg-gray-50">
                <tr>
                    <td colspan="8"
                        class="px-3 py-3 text-right text-sm font-bold text-gray-900">Total:</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm font-bold text-indigo-600 text-right">
                        R {{ line_items_total|floatformat:2|intcomma }}
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
{% else %}
    <div class="text-center py-12 flex flex-col items-center">
        {% heroicon_outline "clipboard-document-list" class="w-12 h-12 text-gray-400" %}
        <h3 class="mt-2 text-sm font-medium text-gray-900">No Transactions</h3>
        <p class="mt-1 text-sm text-gray-500">This payment certificate has no transactions to approve.</p>
    </div>
{% endif %}

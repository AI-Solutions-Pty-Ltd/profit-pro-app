{% extends "base.html" %}
{% load l10n %}
{% block content %}
    <div id="breadcrumb" class="no-print">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href={% url 'home' %}>Home</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">{{ title }}</li>
            </ol>
        </nav>
    </div>
    <form method="post">
        {% csrf_token %}
        <table class="table table-striped table-bordered" style="max-width:100%;">
            <thead>
                <tr>
                    <th>Order Number</th>
                    <th>Order date</th>
                    <th>Supplier</th>
                    <th>Status</th>
                    <th>Inventory Item</th>
                    <th>Price</th>
                    <th>Qty Ordered</th>
                    <th>Qty Delivered</th>
                    <th>Qty Returned</th>
                    <th>Qty Remaining</th>
                </tr>
                <tr>
                    <td>{{ form.purchase_order }}</td>
                    <td></td>
                    <td>{{ form.supplier }}</td>
                    <td>{{ form.status }}</td>
                    <td>{{ form.inventory }}</td>
                    <td></td>
                    <td colspan="4">
                        <input class="btn btn-primary" type="submit" value="Apply Filter" name="filter"
                        </td>
                    </tr>
                </thead>
                <tbody>
                    {% if queryset %}
                        {% for substance in queryset %}
                            {% if substance.order_set.all.0.id %}
                                <tr>
                                    <td>
                                        <a href="{% url 'inventories:order_composition_view' order=substance.order_set.all.0.id %}">PO-{{ substance.order_set.all.0.id|stringformat:"05d" }}</a>
                                    </td>
                                    <td>{{ substance.order_set.all.0.date|date:"Y/m/d" }}</td>
                                    <td>{{ substance.order_set.all.0.supplier.description }}</td>
                                    <td>{{ substance.order_set.all.0.status.description }}</td>
                                    <td>{{ substance.inventory.description }}</td>
                                    <td>R{{ substance.price_excl }}</td>
                                    {% with ordered=substance.qty_ordered delivered=substance.qty_delivered returned=substance.qty_returned %}
                                        <td style="text-align:right">{{ ordered|floatformat:3 }}</td>
                                        <td style="text-align:right">{{ delivered|floatformat:3 }}</td>
                                        <td style="text-align:right">{{ returned|floatformat:3 }}</td>
                                        <td style="text-align:right">{{ ordered|sub:delivered|sub:returned|floatformat:3 }}</td>
                                    {% endwith %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </form>
    {% endblock %}

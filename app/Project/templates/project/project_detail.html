{% extends "base.html" %}
{% block title %}
  {{ project.name }} - {{ block.super }}
{% endblock title %}
{% load humanize %}
{% block content %}
  <div class="px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumb -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
          <a href="{% url 'project:project-list' %}"
             class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600 gap-2">
            {% heroicon_outline "home" size="20" class="text-indigo-600" %}
            Projects
          </a>
        </li>
        <li>
          <div class="flex items-center">
            {% heroicon_outline "chevron-right" %}
            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">{{ project.name }}</span>
          </div>
        </li>
      </ol>
    </nav>
    <!-- Project Card -->
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <!-- Header -->
      <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
        <div class="flex items-center justify-between">
          <h1 class="text-2xl font-bold text-gray-900">{{ project.name }}</h1>
          <div class="flex space-x-3">
            <a href="{% url 'project:project-update' project.pk %}"
               class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
              {% heroicon_outline "pencil" size="20" %}
              Edit Project
            </a>
            <a href="{% url 'project:project-delete' project.pk %}"
               class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
              {% heroicon_outline "trash" size="20" %}
              Delete Project
            </a>
          </div>
        </div>
      </div>
      <!-- Content -->
      <div class="px-6 py-6">
        <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Project Name</dt>
            <dd class="mt-1 text-sm text-gray-900">
              {{ project.name }}
            </dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Owner</dt>
            <dd class="mt-1 text-sm text-gray-900">
              {{ project.account.email }}
            </dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Created</dt>
            <dd class="mt-1 text-sm text-gray-900">
              {{ project.created_at|date:"F d, Y \a\t g:i A" }}
            </dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Last Updated</dt>
            <dd class="mt-1 text-sm text-gray-900">
              {{ project.updated_at|date:"F d, Y \a\t g:i A" }}
            </dd>
          </div>
        </dl>
        <!-- Project Description -->
        {% if project.description %}
          <div class="mt-6 pt-6 border-t border-gray-200">
            <h3 class="text-sm font-medium text-gray-500 mb-2">Description</h3>
            <div class="prose prose-sm max-w-none text-gray-900">{{ project.description|linebreaks }}</div>
          </div>
        {% endif %}
      </div>
      <!-- Line Items Section -->
      <div class="px-6 py-6 border-t border-gray-200">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Line Items ({{ project.line_items.count }})</h2>
          <div class="flex space-x-2">
            <a href="{{ project.get_structure_upload_url }}"
               class="inline-flex items-center px-3 py-1.5 border border-indigo-600 rounded-md shadow-sm text-sm font-medium text-indigo-600 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
              {% heroicon_outline "arrow-up-tray" size="20" %}
              Upload
            </a>
          </div>
        </div>
      </div>
      {% if project.line_items %}
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50 sticky top-0">
              <tr>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Structure</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bill</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Package</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item No.</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pay Ref</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Rate</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              {% for line_item in project.line_items.all %}
                <tr class="hover:bg-gray-50 {% if not line_item.is_work %}bg-gray-100 font-semibold{% endif %}">
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.structure.name }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.bill.name }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.package.name|default:"" }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.item_number|default:"" }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.payment_reference|default:"" }}</td>
                  <td class="px-3 py-2 text-sm text-gray-900">{{ line_item.description|default:"" }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ line_item.unit_measurement|default:"" }}</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right">
                    {% if line_item.budgeted_quantity %}
                      {{ line_item.budgeted_quantity|floatformat:2|intcomma }}
                    {% else %}
                    {% endif %}
                  </td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right">
                    {% if line_item.unit_price %}
                      R {{ line_item.unit_price|floatformat:2|intcomma }}
                    {% else %}
                    {% endif %}
                  </td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right font-medium">
                    {% if line_item.total_price %}
                      R {{ line_item.total_price|floatformat:2|intcomma }}
                    {% else %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
            <tfoot class="bg-gray-50 border-t-2 border-gray-300">
              <tr>
                <td colspan="9"
                    class="px-3 py-3 text-right text-sm font-semibold text-gray-900">Total:</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm font-bold text-gray-900 text-right">
                  R {{ line_items_total|floatformat:2|intcomma }}
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
      {% else %}
        <div class="text-center py-6 flex flex-col items-center">
          {% heroicon_outline "document" %}
          <p class="mt-2 text-sm text-gray-500">Project WBS not loaded, please upload.</p>
          <a href="{% url 'bill_of_quantities:structure-upload' project.pk %}"
             class="mt-2 inline-flex items-center px-3 py-1.5 border border-indigo-600 rounded-md shadow-sm text-sm font-medium text-indigo-600 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
            {% heroicon_outline "arrow-up-tray" size="20" %}
            Upload
          </a>
        </div>
      {% endif %}
      <!-- Footer -->
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
        <div class="flex justify-between items-center">
          <a href="{% url 'project:project-list' %}"
             class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600 transition-colors">
            {% heroicon_outline "chevron-left" %}
            Back to Projects
          </a>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

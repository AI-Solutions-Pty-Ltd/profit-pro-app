{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "serve",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": ["${workspaceFolder}/manage.py", "runserver"],
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "pwd": "${workspaceFolder}"
        }
      },
      "isBackground": true,
      "problemMatcher": {
        "owner": "python",
        "pattern": {
          "regexp": "^.*$",
          "file": 1,
          "location": 2,
          "message": 3
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^Performing system checks",
          "endsPattern": "^(Starting development server|Quit the server|Watching for file changes)"
        }
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      }
    },
    {
      "label": "tailwind",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": ["${workspaceFolder}/manage.py", "tailwind", "start"],
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "pwd": "${workspaceFolder}"
        }
      },
      "problemMatcher": []
    },
    {
      "label": "makemigrations",
      "type": "shell",
      "isBackground": true,
      "command": "${command:python.interpreterPath}",
      "args": ["${workspaceFolder}/manage.py", "makemigrations"],
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "pwd": "${workspaceFolder}"
        }
      }
    },
    {
      "label": "migrate",
      "type": "shell",
      "isBackground": true,
      "command": "${command:python.interpreterPath}",
      "args": ["${workspaceFolder}/manage.py", "migrate"],
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "pwd": "${workspaceFolder}"
        }
      },
      "problemMatcher": []
    },
    {
      "label": "full_migrate",
      "isBackground": true,
      "type": "shell",
      "command": "echo starting",
      "dependsOn": ["makemigrations", "migrate"],
      "problemMatcher": []
    },
    {
      "label": "checks",
      "type": "shell",
      "command": "${command:python.interpreterPath} -m djlint --reformat . && ${command:python.interpreterPath} -m djlint --lint . && ${command:python.interpreterPath} -m ruff format . && ${command:python.interpreterPath} -m ruff check . --fix && ${command:python.interpreterPath} -m ty check .",
      "problemMatcher": []
    },
    {
      "label": "test-cov",
      "type": "shell",
      "args": [
        "-m",
        "pytest",
        "-v",
        "-n",
        "auto",
        "--reuse-db",
        "--durations=10",
        "--cov=.",
        "--cov-report=html"
      ],
      "problemMatcher": [],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "windows": {
        "command": ".venv\\Scripts\\python.exe"
      },
      "linux": {
        "command": ".venv/bin/python"
      },
      "osx": {
        "command": ".venv/bin/python"
      }
    },
    {
      "label": "preflight",
      "type": "shell",
      "command": "echo starting",
      "dependsOn": ["checks", "test-cov"],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "showReuseMessage": false,
        "close": true
      }
    },
    {
      "label": "deploy-staging",
      "type": "shell",
      "command": "git push && git checkout staging && git pull && git merge develop && git push && git checkout develop",
      "problemMatcher": []
    },
    {
      "label": "deploy-main",
      "type": "shell",
      "command": "git push && git checkout main && git pull && git merge staging && git push && git checkout develop",
      "problemMatcher": []
    },
    {
      "label": "full-deploy",
      "type": "shell",
      "command": "echo starting",
      "dependsOn": ["deploy-staging", "deploy-main"],
      "dependsOrder": "sequence",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "showReuseMessage": false,
        "close": true
      }
    }
  ]
}
